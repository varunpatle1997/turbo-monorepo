import aws from 'aws-sdk';
import s3 from 's3-blob-store';
export function createS3({ accessKey = process.env.AWS_ACCESS_KEY_ID || process.env.S3_ACCESS_KEY, secretKey = process.env.AWS_SECRET_ACCESS_KEY || process.env.S3_SECRET_KEY, bucket, region = process.env.AWS_REGION || process.env.S3_REGION, endpoint, s3OptionsPassthrough = {}, }) {
    const client = new aws.S3({
        ...(accessKey && secretKey
            ? {
                credentials: {
                    accessKeyId: accessKey,
                    secretAccessKey: secretKey,
                    sessionToken: process.env.AWS_SESSION_TOKEN,
                },
            }
            : {}),
        ...(region ? { region } : {}),
        ...(endpoint ? { endpoint: new aws.Endpoint(endpoint) } : {}),
        ...(process.env.NODE_ENV === 'test'
            ? { sslEnabled: false, s3ForcePathStyle: true }
            : {}),
        ...s3OptionsPassthrough,
    });
    const location = s3({
        client,
        bucket,
    });
    return location;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiczMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9yZW1vdGUtY2FjaGUvc3RvcmFnZS9zMy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEdBQUcsTUFBTSxTQUFTLENBQUE7QUFFekIsT0FBTyxFQUFFLE1BQU0sZUFBZSxDQUFBO0FBWTlCLE1BQU0sVUFBVSxRQUFRLENBQUMsRUFDdkIsU0FBUyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQ3RFLFNBQVMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUMxRSxNQUFNLEVBQ04sTUFBTSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUN4RCxRQUFRLEVBQ1Isb0JBQW9CLEdBQUcsRUFBRSxHQUNmO0lBQ1YsTUFBTSxNQUFNLEdBQUcsSUFBSSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQ3hCLEdBQUcsQ0FBQyxTQUFTLElBQUksU0FBUztZQUN4QixDQUFDLENBQUM7Z0JBQ0UsV0FBVyxFQUFFO29CQUNYLFdBQVcsRUFBRSxTQUFTO29CQUN0QixlQUFlLEVBQUUsU0FBUztvQkFDMUIsWUFBWSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCO2lCQUM1QzthQUNGO1lBQ0gsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNQLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM3QixHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzdELEdBQUcsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxNQUFNO1lBQ2pDLENBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxFQUFFO1lBQy9DLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDUCxHQUFHLG9CQUFvQjtLQUN4QixDQUFDLENBQUE7SUFFRixNQUFNLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbEIsTUFBTTtRQUNOLE1BQU07S0FDUCxDQUFDLENBQUE7SUFFRixPQUFPLFFBQVEsQ0FBQTtBQUNqQixDQUFDIn0=